<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevTools Test - React Fusion State</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
        .info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        kbd {
            background: #f1f1f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ†Ô∏è DevTools Test Page</h1>
        
        <div class="info">
            <h3>üîß How to test DevTools:</h3>
            <ol>
                <li>Press <kbd>Ctrl+`</kbd> (or <kbd>Cmd+`</kbd> on macOS) to open/close the panel</li>
                <li>Click the buttons below to modify state</li>
                <li>In the debug panel:
                    <ul>
                        <li>Click ‚ñ∂ to expand a state</li>
                        <li>Edit JSON in the textarea</li>
                        <li>Click "Set" to apply or "Reset" to set to null</li>
                        <li>Use "Export" to download complete state</li>
                        <li>Use "Import" to load state from a file</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div id="react-root"></div>
    </div>

    <script type="text/babel">
        // Simulation des hooks react-fusion-state pour le test
        const FusionStateContext = React.createContext();
        
        const FusionStateProvider = ({ children }) => {
            const [state, setState] = React.useState({
                counter: 0,
                user: { name: 'John Doe', age: 30 },
                todos: [
                    { id: 1, text: 'Test DevTools', done: false },
                    { id: 2, text: 'Check JSON editing', done: true }
                ],
                settings: {
                    theme: 'light',
                    notifications: true
                }
            });
            
            return React.createElement(FusionStateContext.Provider, 
                { value: { state, setState } }, 
                children
            );
        };
        
        const useFusionState = (key, initialValue) => {
            const { state, setState } = React.useContext(FusionStateContext);
            
            const value = state[key] !== undefined ? state[key] : initialValue;
            
            const setValue = React.useCallback((newValue) => {
                setState(prev => ({
                    ...prev,
                    [key]: typeof newValue === 'function' ? newValue(prev[key]) : newValue
                }));
            }, [key, setState]);
            
            return [value, setValue];
        };
        
        const useFusionStateLog = () => {
            const { state } = React.useContext(FusionStateContext);
            return state;
        };
        
        // Simulation du FusionDebugPanel (version simplifi√©e pour le test)
        const FusionDebugPanel = ({ visible, onVisibilityChange }) => {
            const globalSnapshot = useFusionStateLog();
            const [expandedKeys, setExpandedKeys] = React.useState({});
            const [editValues, setEditValues] = React.useState({});
            
            React.useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === '`') {
                        e.preventDefault();
                        onVisibilityChange?.(!visible);
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [visible, onVisibilityChange]);
            
            if (!visible) return null;
            
            const exportData = () => {
                const dataStr = JSON.stringify(globalSnapshot, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `fusion-state-${Date.now()}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };
            
            return React.createElement('div', {
                style: {
                    position: 'fixed',
                    bottom: '20px',
                    right: '20px',
                    width: '400px',
                    maxHeight: '600px',
                    backgroundColor: '#1a1a1a',
                    color: 'white',
                    border: '1px solid #333',
                    borderRadius: '8px',
                    fontFamily: 'monospace',
                    fontSize: '12px',
                    zIndex: 9999,
                    overflow: 'hidden'
                }
            }, [
                React.createElement('div', {
                    key: 'header',
                    style: {
                        backgroundColor: '#2d2d2d',
                        padding: '12px',
                        borderBottom: '1px solid #333',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    }
                }, [
                    React.createElement('h3', { key: 'title', style: { margin: 0 } }, 'Fusion State Debugger'),
                    React.createElement('div', { key: 'buttons' }, [
                        React.createElement('button', {
                            key: 'export',
                            onClick: exportData,
                            style: { marginLeft: '5px', padding: '4px 8px', fontSize: '11px' }
                        }, 'Export'),
                        React.createElement('button', {
                            key: 'close',
                            onClick: () => onVisibilityChange?.(false),
                            style: { marginLeft: '5px', padding: '4px 8px', fontSize: '11px' }
                        }, '√ó')
                    ])
                ]),
                React.createElement('div', {
                    key: 'content',
                    style: { padding: '16px', maxHeight: '500px', overflowY: 'auto' }
                }, Object.keys(globalSnapshot).map(key => 
                    React.createElement('div', {
                        key,
                        style: { marginBottom: '10px', border: '1px solid #333', borderRadius: '4px' }
                    }, [
                        React.createElement('div', {
                            key: 'header',
                            onClick: () => setExpandedKeys(prev => ({ ...prev, [key]: !prev[key] })),
                            style: {
                                padding: '8px',
                                backgroundColor: '#2a2a2a',
                                cursor: 'pointer',
                                borderBottom: expandedKeys[key] ? '1px solid #333' : 'none'
                            }
                        }, `${expandedKeys[key] ? '‚ñº' : '‚ñ∂'} ${key}`),
                        expandedKeys[key] && React.createElement('div', {
                            key: 'content',
                            style: { padding: '8px' }
                        }, [
                            React.createElement('textarea', {
                                key: 'textarea',
                                value: editValues[key] || JSON.stringify(globalSnapshot[key], null, 2),
                                onChange: (e) => setEditValues(prev => ({ ...prev, [key]: e.target.value })),
                                style: {
                                    width: '100%',
                                    height: '80px',
                                    backgroundColor: '#1a1a1a',
                                    color: 'white',
                                    border: '1px solid #333',
                                    borderRadius: '4px',
                                    padding: '4px',
                                    fontFamily: 'monospace',
                                    fontSize: '11px'
                                }
                            }),
                            React.createElement('div', {
                                key: 'buttons',
                                style: { marginTop: '8px' }
                            }, [
                                React.createElement('button', {
                                    key: 'set',
                                    onClick: () => {
                                        try {
                                            const parsed = JSON.parse(editValues[key] || JSON.stringify(globalSnapshot[key]));
                                            // Simulation de setState global
                                            console.log('Setting', key, 'to', parsed);
                                        } catch (e) {
                                            alert('Invalid JSON');
                                        }
                                    },
                                    style: { marginRight: '5px', padding: '4px 8px', fontSize: '11px', backgroundColor: '#4caf50' }
                                }, 'Set'),
                                React.createElement('button', {
                                    key: 'reset',
                                    onClick: () => {
                                        setEditValues(prev => ({ ...prev, [key]: 'null' }));
                                    },
                                    style: { padding: '4px 8px', fontSize: '11px', backgroundColor: '#f44336' }
                                }, 'Reset')
                            ])
                        ])
                    ])
                ))
            ]);
        };
        
        // Composant de test principal
        const TestApp = () => {
            const [counter, setCounter] = useFusionState('counter', 0);
            const [user, setUser] = useFusionState('user', { name: 'John Doe', age: 30 });
            const [todos, setTodos] = useFusionState('todos', []);
            const [debugVisible, setDebugVisible] = React.useState(false);
            
            return React.createElement('div', null, [
                React.createElement('div', { key: 'counter', className: 'section' }, [
                    React.createElement('h3', { key: 'title' }, `Counter: ${counter}`),
                    React.createElement('button', {
                        key: 'inc',
                        onClick: () => setCounter(counter + 1)
                    }, 'Increment'),
                    React.createElement('button', {
                        key: 'dec',
                        onClick: () => setCounter(counter - 1)
                    }, 'Decrement'),
                    React.createElement('button', {
                        key: 'reset',
                        onClick: () => setCounter(0)
                    }, 'Reset')
                ]),
                
                React.createElement('div', { key: 'user', className: 'section' }, [
                    React.createElement('h3', { key: 'title' }, `User: ${user.name} (${user.age} ans)`),
                    React.createElement('button', {
                        key: 'age',
                        onClick: () => setUser(prev => ({ ...prev, age: prev.age + 1 }))
                    }, 'Age +1'),
                    React.createElement('button', {
                        key: 'name',
                        onClick: () => setUser(prev => ({ 
                            ...prev, 
                            name: prev.name === 'John Doe' ? 'Jane Smith' : 'John Doe' 
                        }))
                    }, 'Toggle Name')
                ]),
                
                React.createElement('div', { key: 'todos', className: 'section' }, [
                    React.createElement('h3', { key: 'title' }, `Todos (${todos.length})`),
                    React.createElement('ul', { key: 'list' }, 
                        todos.map(todo => 
                            React.createElement('li', { key: todo.id }, 
                                `${todo.text} ${todo.done ? '‚úì' : '‚óã'}`
                            )
                        )
                    ),
                    React.createElement('button', {
                        key: 'add',
                        onClick: () => setTodos(prev => [...prev, { 
                            id: Date.now(), 
                            text: `New todo ${Date.now()}`, 
                            done: false 
                        }])
                    }, 'Add Todo')
                ]),
                
                React.createElement('div', { key: 'debug', className: 'section' }, [
                    React.createElement('h3', { key: 'title' }, 'Debug Panel'),
                    React.createElement('button', {
                        key: 'toggle',
                        onClick: () => setDebugVisible(!debugVisible)
                    }, debugVisible ? 'Hide Debug Panel' : 'Show Debug Panel'),
                    React.createElement('p', { key: 'hint' }, 
                        'Ou appuyez sur Ctrl+` (Cmd+` sur macOS)'
                    )
                ]),
                
                React.createElement(FusionDebugPanel, {
                    key: 'debugpanel',
                    visible: debugVisible,
                    onVisibilityChange: setDebugVisible
                })
            ]);
        };
        
        // Rendu de l'application
        const App = () => {
            return React.createElement(FusionStateProvider, null,
                React.createElement(TestApp)
            );
        };
        
        ReactDOM.render(React.createElement(App), document.getElementById('react-root'));
    </script>
</body>
</html>
